<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Chi tiết hóa đơn</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body { background: #f8f9fa; }
        .card-info { background: #fff; border-radius: 16px; box-shadow: 0 2px 12px #007bff11; padding: 18px 24px; margin-bottom: 18px; }
        .badge-status { font-size: 1em; padding: 0.5em 1em; border-radius: 12px; }
        .badge-pending { background: #fff3cd; color: #856404; }
        .badge-confirmed { background: #d1ecf1; color: #0c5460; }
        .badge-in_progress { background: #cce5ff; color: #004085; }
        .badge-done, .badge-completed { background: #d4edda; color: #155724; }
        .badge-paid { background: #f8d7da; color: #721c24; }
        .table thead th { background: #007bff; color: #fff; border-top: none; }
        .table-bordered { border-radius: 16px; overflow: hidden; }
        .table-hover tbody tr:hover { background: #e9ecef; }
        .note { font-size: 0.97em; color: #555; background: #f1f3f6; border-radius: 8px; padding: 2px 8px; }
        .order-header { display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 18px; }
        .order-header i { color: #007bff; font-size: 2rem; }
        .table td, .table th { vertical-align: middle!important; }
        .btn-back { margin-top: 18px; }
        .total-amount { font-size: 1.4rem; color: #007bff; font-weight: bold; }
        @media (max-width: 600px) {
            .card-info { padding: 12px 6px; }
            .order-header { flex-direction: column; gap: 4px; }
            .total-amount { font-size: 1.1rem; }
        }
    </style>
</head>
<body>
<div class="container py-3">
{% if not bill %}
  <div class="alert alert-warning mt-4"><i class="fas fa-exclamation-triangle me-2"></i>Chưa có hóa đơn nào cho bàn: <b>{{ user_id }}</b></div>
  <a href="{{ url_for('admin_bills') }}" class="btn btn-secondary btn-back"><i class="fas fa-arrow-left me-1"></i>Quay lại danh sách bill</a>
{% else %}
    <div class="order-header">
        <i class="fas fa-receipt"></i>
        <h2 class="text-center m-0">Chi tiết hóa đơn</h2>
    </div>
    <div class="card-info">
        <div class="row g-0 text-center align-items-stretch mb-2" style="border-radius: 12px; overflow: hidden; box-shadow: 0 1px 8px #007bff11;">
            <div class="col-12 col-md-3 p-3 bg-white d-flex flex-column justify-content-center align-items-center border-end">
                <div class="mb-1 text-primary"><i class="fas fa-hashtag fa-lg"></i></div>
                <div class="fw-bold">Order ID</div>
                <div class="text-secondary small">{{ bill['order_id'] }}</div>
            </div>
            <div class="col-12 col-md-3 p-3 bg-white d-flex flex-column justify-content-center align-items-center border-end">
                <div class="mb-1 text-success"><i class="fas fa-chair fa-lg"></i></div>
                <div class="fw-bold">Bàn</div>
                <div class="text-secondary small">{{ bill['user_id'] }}</div>
            </div>
            <div class="col-12 col-md-3 p-3 bg-white d-flex flex-column justify-content-center align-items-center border-end">
                <div class="mb-1 text-warning"><i class="fas fa-clock fa-lg"></i></div>
                <div class="fw-bold">Thời gian tạo</div>
                <div class="text-secondary small">{{ bill['created_at'] }}</div>
            </div>
            <div class="col-12 col-md-3 p-3 bg-white d-flex flex-column justify-content-center align-items-center">
                <div class="mb-1 text-info"><i class="fas fa-info-circle fa-lg"></i></div>
                <div class="fw-bold">Trạng thái</div>
                {% set status = bill.get('status', 'pending') %}
                <span class="badge badge-status badge-{{ status.replace(' ', '_') }} mt-1">
                    {% if status == 'pending' %}<i class="fas fa-hourglass-half me-1"></i>{% endif %}
                    {% if status == 'confirmed' %}<i class="fas fa-check-circle me-1"></i>{% endif %}
                    {% if status == 'in_progress' %}<i class="fas fa-utensils me-1"></i>{% endif %}
                    {% if status == 'done' %}<i class="fas fa-clipboard-check me-1"></i>{% endif %}
                    {% if status == 'paid' %}<i class="fas fa-money-check-alt me-1"></i>{% endif %}
                    {{ status|capitalize }}
                </span>
            </div>
        </div>
        <form method="post" action="{{ url_for('admin_bill_update_status', user_id=bill['user_id'], order_id=bill['order_id']) }}" class="row g-2 align-items-center mb-3 mt-2">
            <div class="col-auto">
                <label for="status" class="col-form-label">Cập nhật trạng thái:</label>
            </div>
            <div class="col-auto">
                <select name="status" id="status" class="form-select">
                    <option value="pending" {% if bill.get('status') == 'pending' %}selected{% endif %}>Chờ xử lý</option>
                    <option value="in_progress" {% if bill.get('status') == 'in_progress' %}selected{% endif %}>Đang làm</option>
                    <option value="done" {% if bill.get('status') == 'done' %}selected{% endif %}>Đã xong</option>
                    <option value="paid" {% if bill.get('status') == 'paid' %}selected{% endif %}>Đã thanh toán</option>
                </select>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-success"><i class="fas fa-sync-alt me-1"></i>Cập nhật</button>
            </div>
        </form>
    </div>
    <h4 class="mt-4 mb-3"><i class="fas fa-list-ul me-2"></i>Danh sách món ăn</h4>
    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle shadow-sm">
            <thead>
                <tr>
                    <th class="text-center">Tên món</th>
                    <th class="text-center">Số lượng</th>
                    <th class="text-center">Thành tiền</th>
                    <th class="text-center">Ghi chú</th>
                    <th class="text-center">Xóa</th>
                </tr>
            </thead>
            <tbody>
            {% for item in bill['items'] %}
                <tr>
                    <td class="text-center">{{ item['dish'] }}</td>
                    <td class="text-center">{{ item['quantity'] }}</td>
                    <td class="text-center"><b>{{ item['amount'] | int | string }} đ</b></td>
                    <td class="note">{{ item.note or item['note'] }}</td>
                    <td class="text-center">
                        <form method="post" action="{{ url_for('admin_remove_item', user_id=bill['user_id'], order_id=bill['order_id']) }}" style="display:inline;">
                            <input type="hidden" name="dish_name" value="{{ item['dish'] }}">
                            <button type="submit" class="btn btn-sm btn-danger" data-bs-toggle="tooltip" data-bs-placement="top" title="Xóa món này" onclick="return confirm('Bạn chắc chắn muốn xóa món này?')">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="text-end mb-4">
        <span class="total-amount"><i class="fas fa-coins me-1"></i>Tổng cộng: {{ bill['total'] | int | string }} đ</span>
    </div>
    <a href="{{ url_for('admin_bills') }}" class="btn btn-secondary btn-back"><i class="fas fa-arrow-left me-1"></i>Quay lại danh sách bill</a>
{% endif %}
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Kích hoạt tooltip Bootstrap
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
</script>
</body>
</html> 